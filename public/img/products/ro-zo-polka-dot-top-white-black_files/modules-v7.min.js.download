/*! johnlewiscom v1.0.0 | 2021-01-29T15:05:56 | ea55943a724469c96d3609dd8d9bb44e68a0a965 | Copyright. All rights reserved. 2021. Digital Media Technologies Ltd. */
"use strict";!function(){if("function"==typeof window.CustomEvent)return;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var a=document.createEvent("CustomEvent");return a.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),a}t.prototype=window.Event.prototype,window.CustomEvent=t}(),function(){function f(){return"treatment"===T||"plp-v1"===T}function o(){return"treatment"===T||"plp-v1"===T||"plp-v3"===T||"plp-v4"===T||"plp-v5"===T||"plp-v6"===T||"plp-v7"===T||"plp-v9"===T}function i(){return"plp-v8"===T}function n(){var t=taggstar.$("div.show-on-desktop, div.show-on-mobile").length,e=taggstar.$('[data-cy="price-and-ratings"]:first').length;return t?"0":e?"1":"2"}function s(){var t=K[ft]||768,e="desktop",a=taggstar.$(window).width();return a<=t&&(e=a<=568?"mobileN":"mobileW"),e}function g(){return"mobileN"===s()||"mobileW"===s()}function p(t){clearInterval(taggstar._timers[t]),taggstar._timers[t]=void 0}function d(){function t(t){return t&&-1<Q.indexOf(t)}var e=taggstar.$("body").data("tagg-insert-function"),a=taggstar.$("body").data("tagg-insert-function-m");return g()&&t(a)&&(e=a),t(e)||(e="product"===ft?U[ft][s()][n()][T]:"category"===ft?U[ft][s()]["plp-v8"===T?"1":"0"]:U[ft][s()]),e}function c(e){function t(t){return t&&qt(t,e).length}var a=taggstar.$("body").data("tagg-anchor"),r=taggstar.$("body").data("tagg-anchor-m");return g()&&t(r)&&(a=r),t(a)||(a="product"===ft?H[ft][s()][n()][T]:"category"===ft?H[ft][s()]["plp-v8"===T?"1":"0"]:H[ft][s()]),qt(a,e)}function v(t,e){var a,r,n;switch(ft){case"category":a=taggstar.$(".product-card").filter('[data-product-id="'+t+'"]');break;case"categoryReact":a=taggstar.$(X+" "+Y+'[data-product-id="'+t+'"]').last(),e||a.find(".tagg-category-page").remove();break;case"basket":r=xt(self.jlData,"basket.product");for(var o=0;o<r.length;o++)if(r[o].productId===t){n=r[o].sku;break}a=taggstar.$(".basket-list-link").filter('[href$="/'+n+'"]').closest("li.basket-list-item")}return c(a)}function e(){taggstar.log("window resized - "+s());var t=taggstar.$(".tagg-balloons-wrapper");t.length&&t.each(function(){var t=d(),e=taggstar.$(this);c(void 0)[t](e)})}function l(a){return new Promise(function(t){try{var e=new CustomEvent("taggstar:response",{detail:function(t){var e={},a=taggstar.getVisitor();return e.version=3,e.visitor=a&&a.id,e.module=yt.module,yt.experienceRequired||t&&t.hasOwnProperty("experiment")&&t.experiment&&(e.experiment={id:t.experiment.id,group:t.experiment.group}),t.action?(e.type="action",e.action=t.action):(e.type="socialProof",e.socialProof=function(t){var e,a,r,n,o,i,s,g=[],p=t.socialProof;if(p)for(e=0;e<p.length;e++)for(r=(n=p[e]).product&&n.product.id,o=n.messages,a=0;a<o.length;a++)s={productId:r,code:(i=o[a]).code,data:i.data,text:i.message},g.push(s);return g}(t)),e}(a)});document.dispatchEvent(e)}catch(t){taggstar.log("error submitting tracking object")}finally{t(a)}})}function m(t){return t&&Array.isArray(t)?t.map(function(t){var e="-";return t&&t.value?(e=t.value.toLowerCase()).replace(/\W+/gi,"-"):e}).join("/"):"-"}function b(){var t;taggstar.log("category ATB Clicked"),t={category:"basket",name:"add",data:{label:taggstar.$(this).closest(".product-card").data("product-id")+"",value:1}},taggstar.eventRequest(t)}function h(){taggstar.$(this).find(".tagg-balloons-wrapper-plp").slideUp()}function y(){taggstar.$(this).find(".tagg-balloons-wrapper-plp").slideDown()}function t(){var t,e,a,r,n,o,i,s,g,p,d,c,l,u;if($=!0,T=yt.experienceRequired?T||taggstar.params&&taggstar.params.taggExperienceId||taggstar.$("body").data("tagg-experience"):void 0,O||(O=m(xt(window.jlData,"page.pageInfo.breadCrumb"))),N={category:O,products:[]},_=document.querySelector("div.product-list-container")){if((!yt.experienceRequired||T)&&N.category)for(e=_.getElementsByClassName("product-list-container__chunk"),d=0;d<e.length;d++)if(n="true"===(i=e[d]).getAttribute("data-tagg-processed"),o="true"===i.getAttribute("data-placeholder-chunks"),!n&&!o)for(ct+=1,i.setAttribute("data-tagg-processed",!0),a=i.getElementsByClassName("product-card"),c=0;c<a.length;c++)r=(s=a[c]).getAttribute("data-product-id"),u=(l=s.querySelector("a.product-card__image-frame"))&&l.getAttribute("href"),r&&It("category",""+r,u,s)&&N.products.indexOf(""+r)<0&&(N.products.push(""+r),f()&&(s.removeEventListener("mouseenter",h),s.addEventListener("mouseenter",h),s.removeEventListener("mouseleave",y),s.addEventListener("mouseleave",y)),(g=s.querySelector(".product-card__action-button.product-card__action-button--trigger"))&&(g.removeEventListener("click",b),g.addEventListener("click",b)));t=_.getAttribute("data-page-end-chunk"),(t=isNaN(t)?1:parseInt(t))<=ct&&(taggstar.log("all chunks loaded!"),dt=!0)}return p=(!yt.experienceRequired||T)&&N.category&&N.products.length&&(!lt||v(xt(N,"products.0"),!0).length),$=!1,p}function a(){var t,e,a,r,n,o,i,s,g=[];if("category"!==yt.module&&(yt.module="category"),T=yt.experienceRequired?T||taggstar.params&&taggstar.params.taggExperienceId||taggstar.$("body").data("tagg-experience"):void 0,O||(O=m(xt(window.jlData,"page.pageInfo.breadCrumb"))),N={category:O,products:[]},R=document.querySelector(X))for(t=R.querySelectorAll(Y),n=0;n<t.length;n++)"true"===(a=t[n]).getAttribute("data-tagg-processed")||(a.setAttribute("data-tagg-processed",!0),(e=a.getAttribute("data-product-id"))&&(e+="",N.products.indexOf(e)<0&&(o=a.querySelector('a[class*="product__image"]').getAttribute("href"),It("category",e,o,a)?(N.products.push(e),f()&&(r=a.querySelector('div[data-test="product-image-container"]'))&&(r.removeEventListener("mouseenter",h),r.addEventListener("mouseenter",h),r.removeEventListener("mouseleave",y),r.addEventListener("mouseleave",y))):g.push(e))));return F=!!(N.category&&0<N.products.length&&v(xt(N,"products.0"),!0).length)||0<g.length,W={},(i=xt(window.jlData,"basket.product"))&&Array.isArray(i)&&mt!==i.length&&(mt=i.length,W={category:"basket",name:"add",data:{label:i[mt-1].productId,value:1}}),z=!!W.category,S={},(s=xt(window.jlData,"page.quickView")||xt(window.jlData,"page.quickview"))&&s.productId&&bt!==s.productId&&0<taggstar.$(Z).length&&(bt=s.productId,S.id=bt,s.breadCrumb&&(S.category=m(s.breadCrumb))),V=!!(S.id&&0<taggstar.$(tt).length),(!yt.experienceRequired||T)&&(F||V||z)}function r(){F&&0<N.products.length&&function(){var t,e,a,r,n=parseInt(N.products.length/100);for(yt.experienceRequired&&(ht.experienceId=T),Object.keys(ht).length&&taggstar.init(ht),e={category:N.category},a=0;a<=n;a++)t=N.products.splice(0,100),(e.products=t).length&&(r=e,taggstar.categoryRequest(r).then(l).then(pt).then(function(t){taggstar._defaultMessageParams=E,taggstar.displayMessageBalloonsMulti(t,v,{wrapperClass:"tagg-balloons-wrapper-plp",extraClass:"tagg-category-page tagg-"+wt,insertFunction:d()}).then(function(){o()?taggstar.$(".tagg-category-page").slideDown():i()&&taggstar.$(".tagg-category-page").animate({left:"-8px",opacity:"1"},250)}).catch(kt)}).catch(kt))}(),z&&taggstar.eventRequest(W),V&&(taggstar.$(".tagg-product-page").remove(),taggstar.productRequest(S).then(l).then(gt).then(function(t){It("product",S.id,xt(window.jlData,"page.quickView.brand")||xt(window.jlData,"page.quickview.brand"))&&(taggstar._defaultMessageParams=E,taggstar.displayMessageBalloons(t,tt,{wrapperClass:"tagg-balloons-wrapper",extraClass:"tagg-product-page tagg-pdp-qv tagg-"+wt+(1<t.length?" tagg-two-balloons":""),insertFunction:"after",customAnimation:$t,tries:1,testInterval:100,firstDelay:50,delayBetween:500}).then(function(){taggstar.$(".tagg-product-page").slideDown(500)}).catch(function(t){"CORE11"!==t.code?kt(t):taggstar.log("balloon anchor not present in DOM: qucik view may not be visible!")}))}).catch(kt))}function u(){taggstar.log("submitting ATB request");var t,e=taggstar.$("#button--add-to-basket");(taggstar.$('[data-cy="stock-availability"]').length||e.length)&&(t={category:"basket",name:"add",data:{label:S.id,value:1}},taggstar.eventRequest(t).then(function(){delete t.eventGroupId,l({action:t})}))}function w(){return"pdp-v1"===T||"pdp-v2"===T||"pdp-v3"===T||"pdp-v4"===T}function k(){taggstar.$(".tagg-balloons-wrapper").remove(),taggstar._defaultMessageParams=E,taggstar.displayMessageBalloons(A,v().selector,{extraClass:"tagg-product-page tagg-"+wt+(1<A.length?" tagg-two-balloons":"")+(0<taggstar.$(".header-wrapper").length?" tagg-pdp-template-2":" tagg-pdp-template-1"),insertFunction:d(),customAnimation:$t,firstDelay:50,delayBetween:500,closeButton:!!w(),wrapperClass:"tagg-balloons-wrapper"}).then(function(){taggstar.$(".tagg-product-page").slideDown(500)}).catch(kt)}function x(){taggstar.$(".tagg-basket-page").remove(),taggstar._defaultMessageParams=E,taggstar.displayMessageBalloonsMulti(A,v,{wrapperClass:"tagg-balloons-wrapper",extraClass:"tagg-basket-page tagg-"+wt,insertFunction:d()}).then(function(){taggstar.$(".tagg-basket-page").slideDown()}).catch(kt)}function q(){var a=!1;return T=yt.experienceRequired?T||taggstar.params&&taggstar.params.taggExperienceId||taggstar.$("body").data("tagg-experience"):void 0,G={lineItems:[]},!!taggstar.$("#main").find(".basket-empty").length||(yt.experienceRequired&&!T||0===taggstar.$(".tagg-exec").length&&xt(self.jlData,"basket.product").forEach(function(t){var e=xt(t,"productId");e&&(It("basket",e,t.sku,t.stockStatus)?G.lineItems.push({id:e,unitPrice:Number(xt(t,"itemPrice").replace(/[^0-9.-]+/g,"")),quantity:xt(t,"qty"),isError:!!xt(t,"error")}):a=!0),taggstar.$(".basket-list-link").filter('[href$="/'+t.sku+'"]').closest("li.basket-list-item").append('<div class="tagg-exec"></div>')}),(!yt.experienceRequired||T)&&(a||G.lineItems.length&&v(xt(G,"lineItems.0.id"),!0).length))}function I(){return taggstar.log("no taggstar executed"),!0}var $,_,R,D,j,C,P,E,A,O,B,M,T,L,N,S,W,F,V,z,G,J,Q=["before","after","prepend","append"],U={category:{desktop:{0:"after",1:"after"},mobileN:{0:"after",1:"after"},mobileW:{0:"after",1:"after"}},categoryReact:{desktop:"append",mobileN:"append",mobileW:"append"},product:{desktop:{0:{treatment:"append","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"},1:{treatment:"after","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"},2:{treatment:"after","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"}},mobileW:{0:{treatment:"append","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"},1:{treatment:"after","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"},2:{treatment:"after","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"}},mobileN:{0:{treatment:"append","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"},1:{treatment:"after","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"},2:{treatment:"after","pdp-v1":"append","pdp-v2":"append","pdp-v3":"append","pdp-v4":"append"}}},basket:{desktop:"after",mobileN:"after",mobileW:"after"}},H={category:{desktop:{0:".product-card__image-frame",1:".product-card__info"},mobileN:{0:".product-card__image-frame",1:".product-card__info"},mobileW:{0:".product-card__image-frame",1:".product-card__info"}},categoryReact:{desktop:'div[data-test="product-image-container"]',mobileN:'div[data-test="product-image-container"]',mobileW:'div[data-test="product-image-container"]'},product:{desktop:{0:{treatment:"div.show-on-desktop header.product-header:first","pdp-v1":"#carousel-wrapper","pdp-v2":"#carousel-wrapper","pdp-v3":"#carousel-wrapper","pdp-v4":"#carousel-wrapper"},1:{treatment:'[data-cy="price-and-ratings"]:first',"pdp-v1":".slick-list:first","pdp-v2":".slick-list:first","pdp-v3":".slick-list:first","pdp-v4":".slick-list:first"},2:{treatment:'[data-cy="delivery"]:first',"pdp-v1":'[data-cy="product-images"]:first div[class*="image-"]:first > div > div',"pdp-v2":'[data-cy="product-images"]:first div[class*="image-"]:first > div > div',"pdp-v3":'[data-cy="product-images"]:first div[class*="image-"]:first > div > div',"pdp-v4":'[data-cy="product-images"]:first div[class*="image-"]:first > div > div'}},mobileW:{0:{treatment:"div.show-on-mobile header.product-header:first","pdp-v1":"#carousel-wrapper","pdp-v2":"#carousel-wrapper","pdp-v3":"#carousel-wrapper","pdp-v4":"#carousel-wrapper"},1:{treatment:'[data-cy="price-and-ratings"]:first',"pdp-v1":".slick-list:first","pdp-v2":".slick-list:first","pdp-v3":".slick-list:first","pdp-v4":".slick-list:first"},2:{treatment:'div[class*="price-and-rating-"]:first',"pdp-v1":'[data-cy="image-slider"]:first',"pdp-v2":'[data-cy="image-slider"]:first',"pdp-v3":'[data-cy="image-slider"]:first',"pdp-v4":'[data-cy="image-slider"]:first'}},mobileN:{0:{treatment:"div.show-on-mobile header.product-header:first","pdp-v1":"#carousel-wrapper","pdp-v2":"#carousel-wrapper","pdp-v3":"#carousel-wrapper","pdp-v4":"#carousel-wrapper"},1:{treatment:'[data-cy="price-and-ratings"]:first',"pdp-v1":".slick-list:first","pdp-v2":".slick-list:first","pdp-v3":".slick-list:first","pdp-v4":".slick-list:first"},2:{treatment:'div[class*="price-and-rating-"]:first',"pdp-v1":'[data-cy="image-slider"]:first',"pdp-v2":'[data-cy="image-slider"]:first',"pdp-v3":'[data-cy="image-slider"]:first',"pdp-v4":'[data-cy="image-slider"]:first'}}},basket:{desktop:".basket-list-container",mobileN:".basket-list-container",mobileW:".basket-list-container"}},K={category:768,product:768,basket:768},X="#js-plp-body",Y="section[data-product-id]",Z='.ReactModalPortal div[role="dialog"]',tt='.ReactModalPortal div[class*="header-info_priceAndRating"]',et=!1,at=["browse","search","search results","product list page grid"],rt=["product","standard product","fashion product","electricals product"],nt=["basket","shopping basket"],ot=["jl:checkout:orderreceipt"],it=["apple","powerbeats","beats","chanel"],st=/apple|powerbeats|beats|chanel/i,gt=taggstar.handleProductResponse,pt=taggstar.handleResponseMulti,dt=!1,ct=0,lt=!0,ut=0,ft="",vt=[],mt=0,bt=0,ht={},yt=taggstar.config,wt=yt.key,kt=taggstar.exception.handle,xt=taggstar.util.getObjectByPath,qt=function(t,e){var a;return(a=e?e.is(t)?e:e.find(t):taggstar.$(t)).selector||(a.selector=t),a},It=function(t,e,a,r){var n,o,i,s,g,p=!0;if("category"===t&&(n=xt(window.jlData,"page.productPages.products.chunkDetails.products"))&&Array.isArray(n)){if((o=n.filter(function(t){return t.productId==e}))&&o.isOutOfStock)return taggstar.log("[out of stock - by jlData] not sent for product id:"+e),!1;if(r.querySelector('[class*="stock"]'))return taggstar.log("[out of stock - by DOM] not sent for product id:"+e),!1}if("product"===t&&(o=xt(window.jlData,"page.productPages"))&&0===o.numberOfAvailableProductSkus)return taggstar.log("[out of stock] not sent for product id:"+e),!1;if("basket"===t){if("outofstock"===r)return taggstar.log("[out of stock - by jlData] not sent for product id:"+e),!1;if((i=taggstar.$(".basket-list-link").filter('[href$="/'+a+'"]').eq(0).find("h2.product-list-title")).length&&i.text())for(s=i.text().trim().toLowerCase().split(/\s+/g).map(function(t){return t.replace(/\W+/g,"")}),g=0;g<it.length;g++)if(-1<s.indexOf(it[g])){taggstar.log("[brand filtered: "+it[g]+"] message filtered for id:"+e),p=!1;break}if(!p)return taggstar.log("brand is outed"),!1}return!a||"basket"===t||!st.test(a)||(taggstar.log("[brand filtered: "+a+"] message filtered for id:"+e),!1)},$t=function(e,t,a){function r(t){et=!0,t&&p("animInterval"),taggstar.log("wrapper faded out"),e.fadeOut(500,function(){taggstar.log("wrapper removed"),e.remove()})}var n="pdp-v2"===T?3e3:4e3,o=0<e.find("div.tagg-balloon").length,i={opacity:0,height:0},s={"margin-left":"0",height:"pdp-v3"===T||"pdp-v4"===T?"50px":w()&&g()?"64px":"68px"};i["margin-left"]=o?0:"-100%",t.css(i),w()&&t.find(".tagg-x").on("click",function(t){t.stopPropagation(),r(),l({action:{category:"message",name:"message-close"}})}),e.append(t),o?(s.opacity=0,taggstar._timers.animInterval=setInterval(function(){s.opacity=0===s.opacity?1:0,t.css(s),t.prev().css({opacity:1===s.opacity?0:1}),"pdp-v2"===T&&3<++ut&&r(!0)},n)):taggstar._timers.animTimeout=setTimeout(function(){s.opacity=1,t.css(s),"pdp-v2"===T&&1===A.length&&(ut++,setTimeout(function(){r()},6e3))},a.firstDelay)},_t={categoryReact:{condition:a,module:function(){try{taggstar._timers.plpReactBoot||(taggstar._timers.plpReactBoot=setInterval(function(){(lt||a())&&(lt=!1,r())},3*yt.interval))}catch(t){p("plpReactBoot")}}},category:{condition:t,module:function(){try{taggstar._timers.plpBoot||(taggstar._timers.plpBoot=setInterval(function(){(lt||!dt&&!$&&t())&&(lt&&(lt=!1),function(){var t,e,a,r=parseInt(N.products.length/100);for(yt.experienceRequired&&(ht.experienceId=T),Object.keys(ht).length&&taggstar.init(ht),t={category:N.category},e=0;e<=r;e++)(71<(vt=vt.concat(N.products.splice(0,100))).length||dt)&&(t.products=vt.slice(0,vt.length+1),t.products.length&&(vt=[],a=t,taggstar.categoryRequest(a).then(l).then(taggstar.handleResponseMulti).then(function(t){taggstar._defaultMessageParams=E,taggstar.displayMessageBalloonsMulti(t,v,{wrapperClass:"tagg-balloons-wrapper-plp",extraClass:"tagg-category-page tagg-"+wt,insertFunction:d()}).then(function(){o()?taggstar.$(".tagg-category-page").slideDown():i()&&taggstar.$(".tagg-category-page").animate({left:"-8px",opacity:"1"},250)}).catch(kt)}).catch(kt)))}()),g()||(D=document.querySelectorAll("#quickview-modal")).length&&(j=D[D.length-1],(C=j.getElementsByClassName("plp-quickview-product__header")).length&&!C[0].getAttribute("data-tagg-isqv")&&(C[0].setAttribute("data-tagg-isqv",!0),j.addEventListener("click",function(t){var e;"button--qv-add-to-basket"===t.target.id&&(e={category:"basket",name:"add",data:{label:xt(self.jlData,"page.quickview.productId"),value:1}},taggstar.eventRequest(e))}),taggstar.$(".tagg-product-page").remove(),taggstar.productRequest({id:xt(window.jlData,"page.quickview.productId"),category:m(xt(window.jlData,"page.quickview.breadCrumb"))}).then(l).then(taggstar.handleProductResponse).then(function(t){taggstar._defaultMessageParams=E,taggstar.displayMessageBalloons(t,".plp-quickview-product__header",{wrapperClass:"tagg-balloons-wrapper",extraClass:"tagg-product-page tagg-pdp-qv tagg-"+wt+(1<t.length?" tagg-two-balloons":""),insertFunction:d(),customAnimation:$t,tries:1,testInterval:100,firstDelay:50,delayBetween:500}).then(function(){taggstar.$(".tagg-product-page").slideDown(500)}).catch(function(t){"CORE11"!==t.code?kt(t):taggstar.log("balloon anchor not present in DOM: qucik view may not be visible!")})}).catch(kt)))},3*yt.interval))}catch(t){p("plpBoot")}}},product:{condition:function(){var t;return T=yt.experienceRequired?T||taggstar.params&&taggstar.params.taggExperienceId||taggstar.$("body").data("tagg-experience"):void 0,S={category:m(xt(window.jlData,"page.pageInfo.breadCrumb"))},(t=window.location.pathname.match(/\/p(\d{3,})/i))&&1<t.length?S.id=t[1]+"":S.id=xt(window.jlData,"page.productPages.productId"),(!yt.experienceRequired||T)&&S.id&&v().length},module:function(){yt.experienceRequired&&(ht.experienceId=T),Object.keys(ht).length&&taggstar.init(ht),taggstar.productRequest(S).then(l).then(taggstar.handleProductResponse).then(function(t){A=t,k(),A.length&&!P&&(P=!0,taggstar.log("adding resize listener"),taggstar.$(window).on("resize",function(r,n,o){var i;return function(){var t=this,e=arguments,a=o&&!i;clearTimeout(i),i=setTimeout(function(){i=null,o||r.apply(t,e)},n),a&&r.apply(t,e)}}(e,yt.interval/2)))}).then(function(){var t;taggstar._timers.pdpAtb||(taggstar._timers.pdpAtb=setInterval(function(){(t=taggstar.$('#button--add-to-basket, [data-cy="add-to-basket-button"]:first')).data("tagg-processed")||(t.data("tagg-processed",!0),t.off("click",u).on("click",u)),A.length&&0===taggstar.$(".tagg-product-page").length&&!et&&k()},3*yt.interval))}).catch(kt)}},basket:{condition:q,module:function(){try{taggstar._timers.basketBoot||(taggstar._timers.basketBoot=setInterval(function(){(lt||q())&&(lt=!1,function(){if(0===G.lineItems.length)return taggstar.log("basket is empty"),p("basketBoot");A?x():(yt.experienceRequired&&(ht.experienceId=T),Object.keys(ht).length&&taggstar.init(ht),G.lineItems=G.lineItems.filter(function(t){return!t.isError}),G.lineItems.length&&taggstar.basketRequest(G).then(l).then(taggstar.handleResponseMulti).then(function(t){A=t,x()}).catch(kt))}())},3*yt.interval))}catch(t){p("basketBoot")}}},conversion:{condition:function(){return J={id:xt(self.jlData,"checkout.receipt.order.purchaseId"),currency:xt(self.jlData,"checkout.payment.order.currency"),totalPrice:Number(xt(self.jlData,"checkout.receipt.order.totalToPay").replace(/[^0-9.-]+/g,"")),orderItems:[]},xt(self.jlData,"checkout.product").forEach(function(t){J.orderItems.push({id:xt(t,"productId"),unitPrice:xt(t,"itemPrice"),category:xt(t,"category"),quantity:xt(t,"qty")})}),J.id&&J.currency&&J.totalPrice&&J.orderItems.length},module:function(){ht.currencyCode=J.currency,taggstar.init(ht),taggstar.conversionRequest(J).then(l).then(function(t){taggstar.log("conversion successful","info"),taggstar.log(t,"info")}).catch(kt)}},do_nothing:{condition:I,module:I}};E=taggstar._defaultMessageParams,taggstar._timers={pdpAtb:void 0,plpBoot:void 0,plpReactBoot:void 0,basketBoot:void 0,animTimeout:void 0,animInterval:void 0,minibag:void 0},taggstar.handleProductResponse=function(p){return new Promise(function(t,e){taggstar.log("response received","info"),taggstar.log(p,"info");var a,r=xt(self.jlData,"page.productPages.brand")||xt(self.jlData,"page.quickview.brand")||xt(self.jlData,"page.quickView.brand"),n=p.socialProof,o=n&&Array.isArray(n)&&n.length,i=o?n[0].messages:[],s=o?n[0].product:{id:""},g=xt(self.jlData,"page.productPages.numberOfAvailableProductSkus")||xt(self.jlData,"page.quickview.numberOfAvailableProductSkus")||xt(self.jlData,"page.quickView.numberOfAvailableProductSkus")||0;for(a=i.length-1;0<=a;a--)i[a].message||(i.splice(a,1),e(new TaggstarError({message:"missing message body",code:"CORE19",severity:81})));r&&(r=r.toLowerCase(),-1<it.indexOf(r)&&(taggstar.log("[brand: "+r+"] message filtered for id:"+s.id),i=[])),0===g&&(taggstar.log("[out of stock] message filtered for id:"+s.id),i=[]),t(i)})},taggstar.boot(function(){var t=taggstar.$("#jsonPageData").text();try{B||(B=JSON.parse(t||"{}")),M||(M=window.jlData)}catch(t){return"do_nothing"}return B&&M&&(ft=function(){var t=xt(B,"pageType")||xt(window.jlData,"page.pageInfo.pageType");return!!t&&(t=t.toLowerCase(),-1<at.indexOf(t)&&/sofa|upholstery-beta/gi.test(window.location.pathname))}()?"do_nothing":function(){var t=taggstar.$("body").attr("id"),e=xt(B,"pageType")||xt(window.jlData,"page.pageInfo.pageType");return!!e&&(e=e.toLowerCase(),-1<at.indexOf(e)&&"plp-root"===t)}()?"categoryReact":function(){var t=xt(B,"pageType")||xt(window.jlData,"page.pageInfo.pageType");return!!t&&(t=t.toLowerCase(),-1<at.indexOf(t))}()?"category":function(){var t=xt(B,"pageType")||xt(window.jlData,"page.pageInfo.pageType");return!!t&&(t=t.toLowerCase(),-1<rt.indexOf(t)||/\/p(\d{3,})/gi.test(window.location.pathname))}()?"product":function(){var t=xt(B,"pageType")||xt(window.jlData,"page.pageInfo.pageType");return!!t&&(t=t.toLowerCase(),-1<nt.indexOf(t))}()?"basket":function(){var t=xt(window.jlData,"page.pageInfo.pageName");return!!t&&(t=t.toLowerCase(),-1<ot.indexOf(t))}()?"conversion":taggstar.constant.null),ft},_t).then(function(){function e(t){return taggstar.$('div[data-test="item-content-row"][data-product-id="'+t+'"]').find('[data-attribute="maxibasket-taggstar-message-anchor"]')}var t,a,r;try{taggstar._timers.minibag||(taggstar._timers.minibag=setInterval(function(){var o="";t=taggstar.$("#minibasket-overlay"),"visible"===t.css("visibility")?(taggstar.log("minibag: visible"),L=yt.experienceRequired?L||taggstar.params&&taggstar.params.taggMaxibasketExperienceId||taggstar.$("body").data("tagg-maxibasket-experience"):void 0,!yt.experienceRequired||L?(taggstar.$('div[data-test="item-content-row"]').each(function(){var t=taggstar.$(this),e=t.data("product-id"),a=t.data("stock-level"),r=t.data("product-name"),n=t.data("tagg-processed");a<1?taggstar.log("minibag: no stock for id: "+e):r&&st.test(r.toLowerCase())?taggstar.log("minibag: brand filter for id: "+e):n?taggstar.log("minibag: already processed for id: "+e):(t.data("tagg-processed",!0),o+=e+",")}),o?(o=o.substr(0,o.length-1),taggstar.log("minibag: request for id(s): "+o),a=taggstar.util.createTaggstarQueryString(),r=taggstar.config.urls.apiRoot+"/api/v2/key/"+taggstar.config.key+"/products",r+="?ids="+o,L&&(r+="&experienceId="+L),r+=a?"&"+a.substring(1):"",taggstar.util.jsonCall("GET",r).then(function(t){return taggstar._addResponseToCookie(t),t}).then(taggstar.handleResponseMulti).then(function(t){taggstar.$(".tagg-mini-basket-page").remove(),taggstar._defaultMessageParams=E,taggstar.displayMessageBalloonsMulti(t,e,{extraClass:"tagg-mini-basket-page tagg-"+wt,insertFunction:"append",wrapperClass:"tagg-balloons-wrapper-mb"}).then(function(){taggstar.$(".tagg-mini-basket-page").slideDown()}).catch(kt)}).catch(kt)):taggstar.log("minibag: no eligable item")):taggstar.log("minibag: no experience")):taggstar.log("minibag: hidden")},3*yt.interval))}catch(t){p("minibag")}}).catch(kt)}(window);