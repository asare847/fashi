(window.webpackJsonpjl_reviews=window.webpackJsonpjl_reviews||[]).push([[6],{13:function(e,t,n){"use strict";n.r(t);var r=n(31),a=n(32),s=n(33),o=n(44),i=n(115),c=n(9),u=n.n(c),l=n(10),d=n.n(l),p=n(75),b=n.n(p),v=n(46),h=n(18),f=n(65),g=n(66),m=n.n(g),w=n(151),j=n.n(w),O=Object(c.lazy)((function(){return Promise.all([n.e(0),n.e(4),n.e(8)]).then(n.bind(null,283))})),S=function(e){var t=e.productId,n=e.apiKey,r=e.productUrl,a=e.clientId,s=e.modalRootId,o=e.displayTitle,i=e.defaultSort,l=e.experiments;return u.a.createElement(f.a,null,u.a.createElement(h.a,{productId:t,apiKey:n,clientId:a,displayTitle:o,defaultSort:i,experiments:l},u.a.createElement(c.Suspense,{fallback:u.a.createElement("div",{className:j.a.container},u.a.createElement("div",{className:j.a.spinner},u.a.createElement(m.a,null)))},u.a.createElement(O,{productId:t,productUrl:r,modalRootId:s,displayTitle:o,experiments:l}))))},R=n(53);n.d(t,"default",(function(){return C}));var E=Object(v.a)().urls,y=E.cssUrl,I=E.jlpStylesCss,C=function(e){Object(s.a)(n,e);var t=Object(o.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"connectedCallback",value:function(){var e={productId:this.getAttribute("productId"),apiKey:this.getAttribute("apiKey"),productUrl:this.getAttribute("productUrl"),clientId:this.getAttribute("clientId"),modalRootId:this.getAttribute("modalRootId"),displayTitle:this.getAttribute("displayTitle"),defaultSort:this.getAttribute("defaultSort"),experiments:Object(R.a)(this.getAttribute("experiments"))},t="function"===typeof document.body.attachShadow?u.a.createElement(b.a,{mode:"open"},u.a.createElement("link",{href:I,rel:"stylesheet"}),u.a.createElement("link",{href:y,rel:"stylesheet"}),u.a.createElement(S,e)):u.a.createElement(S,e);d.a.render(t,this)}}]),n}(Object(i.a)(HTMLElement))},18:function(e,t,n){"use strict";var r=n(51),a=n(47),s=n.n(a),o=n(114),i=n(48),c=n(31),u=n(32),l=n(45),d=n(33),p=n(44),b=n(20),v=n(9),h=n.n(v),f=n(34),g=n.n(f),m=n(52),w=n(35),j=n(46),O=function(e,t,n){var r=function(n,r,a,s,o,i){return"".concat(e,"/v1/reviews?productId=").concat(n,"&pageNumber=").concat(r,"&pageSize=").concat(a)+"&sort=".concat(s,"&api_key=").concat(t)+(i?"&search=".concat(i):"")+(o.length?"&filters=".concat(o.join()):"")},a=function(n){return"".concat(e,"/v1/reviews/").concat(n,"?api_key=").concat(t)};return{getReviews:function(){var e=Object(i.a)(s.a.mark((function e(t,a,o,i,c,u){var l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.get(r(t,a,o,i,c,u),{headers:{"X-Client-Id":n,"X-Correlation-Id":Object(m.v4)()}});case 3:if("OK"!==!(l=e.sent).statusText){e.next=6;break}return e.abrupt("return");case 6:return e.abrupt("return",l.data);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",{error:!0});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,n,r,a,s,o){return e.apply(this,arguments)}}(),getReview:function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.get(a(t),{headers:{"X-Client-Id":n,"X-Correlation-Id":Object(m.v4)()}});case 3:if("OK"!==!(r=e.sent).statusText){e.next=6;break}return e.abrupt("return");case 6:return e.abrupt("return",r.data);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",{error:!0});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),buildFeedbackRequest:function(r,a){return{method:"post",url:"".concat(e,"/v1/reviews/").concat(r,"/feedback"),params:{api_key:t},headers:{"X-Client-Id":n,"X-Correlation-Id":Object(m.v4)()},data:{feedbackType:a}}},productReviewsUrl:r,reviewUrl:a}},S=n(26),R=n(64),E=n(89),y=n(53);n.d(t,"b",(function(){return L})),n.d(t,"a",(function(){return k}));var I=Object(v.createContext)(),C={apiUrl:Object(j.a)().urls.reviews}.apiUrl,k=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return e=t.call.apply(t,[this].concat(a)),Object(b.a)(Object(l.a)(e),"state",{reviews:[],filters:[],userFeedback:Object(w.b)(),offset:0,pageNumber:1,loading:!1,totalResults:e.props.totalResults,nativeResults:e.props.nativeResults,syndicatedResults:e.props.syndicatedResults,samplingResults:e.props.samplingResults,sort:e.props.defaultSort||"newest",submittingFeedback:null,searchField:null,currentSearch:null,searchError:!1,functionalCookiesEnabled:!1,error:!1,recordedImpressions:!1}),Object(b.a)(Object(l.a)(e),"pageSize",e.props.pageSize||5),Object(b.a)(Object(l.a)(e),"cookieConsentReload",(function(){e.setState({functionalCookiesEnabled:Object(E.storageCanBeSet)(R.localStorage.userFeedback)})})),Object(b.a)(Object(l.a)(e),"sendFeedback",(function(t,n){e.setState({submittingFeedback:t}),g()(e.API.buildFeedbackRequest(t,n)).then((function(){e.setState({submittingFeedback:null,userFeedback:Object(w.d)(t,n)})}))})),Object(b.a)(Object(l.a)(e),"sendReport",(function(t,n,r,a){return g()({method:"post",url:"".concat(C||e.props.apiUrl,"/v1/reviews/").concat(t,"/reports"),params:{api_key:e.props.apiKey},headers:{"X-Client-Id":e.props.clientId,"X-Correlation-Id":Object(m.v4)()},data:{reason:n,email:r,comment:a}})})),Object(b.a)(Object(l.a)(e),"resetAndLoad",(function(){e.setState({pageNumber:1},(function(){return e.loadReviews(!0)}))})),Object(b.a)(Object(l.a)(e),"loadMore",(function(){var t=e.state.pageNumber;e.setState({pageNumber:t+1},e.loadReviews)})),Object(b.a)(Object(l.a)(e),"loadReviews",Object(i.a)(s.a.mark((function t(){var n,r,a,i,c,u,l,d,p,b=arguments;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=b.length>0&&void 0!==b[0]&&b[0],r=e.props.productId,a=e.state,i=a.pageNumber,c=a.reviews,u=a.sort,l=a.filters,d=a.currentSearch,e.setState({loading:!0}),t.next=6,e.API.getReviews(r,i,e.pageSize,u,l,d);case 6:if(!(p=t.sent).error){t.next=10;break}return e.setState({error:!0}),t.abrupt("return");case 10:if(!(p&&p.reviews&&0===p.reviews.length&&d)){t.next=13;break}return e.setState({searchError:!0}),t.abrupt("return");case 13:e.setState({api:e.API,reviews:n?p.reviews:[].concat(Object(o.a)(c),Object(o.a)(p.reviews)),loading:!1,ratingsDistribution:p.overallRatings,subRatings:p.overallRatingsQuestions,averageRating:0,noOfReviews:p.summary.totalResults,noOfApiReviews:p.summary.totalResults,totalResults:p.summary.totalResults,nativeResults:p.summary.nativeResults,syndicatedResults:p.summary.syndicatedResults,samplingResults:p.summary.samplingResults,reviewMedia:p.overallReviewMedia});case 14:case"end":return t.stop()}}),t)})))),Object(b.a)(Object(l.a)(e),"changeSort",(function(t){var n=t.target.value;Object(S.e)(n),e.setState({sort:n,reviews:[]},e.resetAndLoad)})),Object(b.a)(Object(l.a)(e),"updateSearchField",(function(t){var n=t.target.value;return e.setState({searchField:n,currentSearch:null})})),Object(b.a)(Object(l.a)(e),"resetSearch",(function(){e.setState({currentSearch:null,searchField:null,searchError:null},e.resetAndLoad)})),Object(b.a)(Object(l.a)(e),"search",(function(t){t.preventDefault(),Object(S.d)();var n=e.state.searchField;e.setState({currentSearch:n,searchError:null},e.resetAndLoad)})),Object(b.a)(Object(l.a)(e),"clear",(function(){e.setState({currentSearch:null,searchError:null,searchField:null,filters:[]},e.resetAndLoad)})),Object(b.a)(Object(l.a)(e),"toggleFilter",(function(t){return function(){var n=e.state.filters,r=n.indexOf(t),a=[];r>-1?(n.splice(r,1),a=n):a=[].concat(Object(o.a)(n),[t]),e.setState({filters:a.sort((function(e,t){return e>t?-1:1})),searchError:null},e.resetAndLoad)}})),e}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.API=O(C||this.props.apiUrl,this.props.apiKey,this.props.clientId),this.setState({functionalCookiesEnabled:Object(E.storageCanBeSet)(R.localStorage.userFeedback)}),this.loadReviews(),document.body.addEventListener("jl-privacy:cookiePreferences",this.cookieConsentReload);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:!this.state.recordedImpressions&&(null===(t=this.state.reviewMedia)||void 0===t?void 0:t.length)>0&&(Object(y.b)(this.props.experiments),this.setState({recordedImpressions:!0}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.children,t=Object(r.a)(Object(r.a)({},this.state),{},{sortOptions:w.e,pageSize:this.pageSize,onClear:this.clear,onSearch:this.search,onSearchFieldUpdate:this.updateSearchField,onResetSearch:this.resetSearch,onSortChange:this.changeSort,onLoadMore:this.loadMore,onSendFeedback:this.sendFeedback,onSendReport:this.sendReport,onToggleFilter:this.toggleFilter});return h.a.createElement(I.Provider,{value:t},e)}}]),n}(h.a.Component),L=function(){return Object(v.useContext)(I)}},26:function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return c}));var r=function(){document.body.dispatchEvent(new CustomEvent("dataStateChange",{detail:{action:"global.pageInteraction",location:"pdp",description:"Write a review",pageChange:!0}}))},a=function(){document.body.dispatchEvent(new CustomEvent("dataStateChange",{detail:{action:"global.pageInteraction",location:"pdp",description:"Search Reviews",pageChange:!1}}))},s=function(e){document.body.dispatchEvent(new CustomEvent("dataStateChange",{detail:{action:"global.pageInteraction",location:"pdp",description:"Sort Reviews",sortBy:e,pageChange:!1}}))},o=function(e,t,n,r,a,s){var o={action:"global.impression",type:"pdp",subType:"ratingsAndReviews",additionalInfo:{totalResults:e,nativeResults:t,syndicatedResults:n,samplingResults:r}};o.additionalInfo.reviewerPhotoPresent=a?"true":"false",o.additionalInfo.customerPhotoGalleryPresent=s?"true":"false";var i=new CustomEvent("dataStateChange",{detail:o});document.body.dispatchEvent(i)},i=function(){document.body.dispatchEvent(new CustomEvent("dataStateChange",{detail:{action:"global.modalOpened",location:"pdp",description:"reviewer photo - gallery"}}))},c=function(){document.body.dispatchEvent(new CustomEvent("dataStateChange",{detail:{action:"global.modalOpened",location:"pdp",description:"reviewer photo - review"}}))}},35:function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"d",(function(){return l})),n.d(t,"a",(function(){return d}));var r=n(20),a=n(51),s=n(88),o=n.n(s),i=[{label:"Newest",value:"newest"},{label:"Highest rating",value:"highest-rating"},{label:"Lowest rating",value:"lowest-rating"},{label:"Most useful",value:"useful"},{label:"Reviewer photos",value:"media-sort"}],c=[{label:"Sort by date",value:"sort-by-date"},{label:"Star rating high to low",value:"star-rating-high-to-low"},{label:"Star rating low to high",value:"star-rating-low-to-high"}],u=function(){return o.a.get("userFeedback")?o.a.get("userFeedback"):(o.a.set("userFeedback",{}),{})},l=function(e,t){var n,s=o.a.get("userFeedback");return n=Object(a.a)(Object(a.a)({},s),{},Object(r.a)({},e,t)),o.a.set("userFeedback",n),n},d=function(e,t){return"/reviews/write-a-review?productId=".concat(e,"&productUrl=")+encodeURIComponent(encodeURIComponent(t))}},46:function(e,t,n){"use strict";var r;t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object({REVIEWS_SERVICE:"https://api.johnlewis.com/ratings-reviews",REVIEWS_TEMPLATE:"https://storage.googleapis.com/jl-ratings-reviews-ui-demo-flex/index.html?productId=4367109",NODE_ENV:"production",JL_VENDOR_BUNDLE:"https://www.johnlewis.com/static/core/js/v2.0/jlp-vendor-bundle-production.js",JL_WEBCOMPONENTS_LOADER:"https://www.johnlewis.com/static/core/js/v1.0/webcomponents-loader.js",JL_STYLES_CSS:"https://www.johnlewis.com/static/core/css/jlp-styles.css",REVIEWS_LISTING_LIB_URL:"https://www.johnlewis.com/ratings-reviews-ui/static/js/index.js",HIGHLIGHT_REVIEW_LIB_URL:"",CSS_URL:"https://www.johnlewis.com/ratings-reviews-ui/static/css/jl-reviews.c8537a3.css",HOST_PATH:"https://www.johnlewis.com/ratings-reviews-ui/static",MONETATE_URL:"https://engine.monetate.net/api/engine/v1/decide/JohnLewis",MONETATE_CHANNEL:"a-76ca7dd3/p/johnlewis.com"});return r||(r={urls:{reviews:e.REVIEWS_SERVICE,cssUrl:e.CSS_URL,jlpStylesCss:e.JL_STYLES_CSS}}),r}},53:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return c}));var r=n(90),a=n.n(r),s=n(34),o=n.n(s),i=function(e){return e?JSON.parse(atob(e)):[]},c=function(e){var t=e.filter((function(e){return e.parameters&&e.parameters.rrimpression})).map((function(e){return e.impressionId})),n=a.a.get("mt.v");if(t.length>0){var r={channel:"a-76ca7dd3/p/johnlewis.com",events:[{eventType:"monetate:record:Impressions",impressionIds:t}]};n&&(r.monetateId=n),o.a.post("https://engine.monetate.net/api/engine/v1/decide/JohnLewis",r).catch((function(){return console.warn("Failed to record monetate impression")}))}}},64:function(e){e.exports={localStorage:{userFeedback:"Functional"}}},65:function(e,t,n){"use strict";var r=n(31),a=n(32),s=n(45),o=n(33),i=n(44),c=n(20),u=n(9),l=n.n(u),d=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return e=t.call.apply(t,[this].concat(o)),Object(c.a)(Object(s.a)(e),"state",{hasIntersected:!1}),Object(c.a)(Object(s.a)(e),"targetContainerRef",Object(u.createRef)()),Object(c.a)(Object(s.a)(e),"loadByEvent",(function(){e.setState({hasIntersected:!0}),e.observer.unobserve(e.targetContainerRef.current)})),Object(c.a)(Object(s.a)(e),"load",(function(t){if(!e.state.hasIntersected){var n=t.find((function(t){return t.target===e.targetContainerRef.current}));n&&n.isIntersecting&&(e.setState({hasIntersected:!0}),e.observer.unobserve(e.targetContainerRef.current))}})),e}return Object(a.a)(n,[{key:"componentDidMount",value:function(){this.observer=new IntersectionObserver(this.load,{root:null,rootMargin:"400px 0px",threshold:0}),this.observer.observe(this.targetContainerRef.current),window.addEventListener("jl-events.browser.loadReviews",this.loadByEvent)}},{key:"componentWillUnmount",value:function(){this.observer.unobserve(this.targetContainerRef.current),document.removeEventListener("jl-events.browser.loadReviews",this.loadByEvent)}},{key:"render",value:function(){var e=this.props.children,t=void 0===e?null:e;return l.a.createElement("div",{ref:this.targetContainerRef},this.state.hasIntersected&&t)}}]),n}(u.Component);t.a=d}}]);