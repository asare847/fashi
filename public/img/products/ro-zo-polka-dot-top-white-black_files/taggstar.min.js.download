/*!taggstar-core 3.9.1 | 2019-10-23T11:18:00 | b83263ba1c4a9dec6f0e34aaa1c0499f4c9be15d | Copyright. All rights reserved. 2019. Digital Media Technologies Ltd.

Promise Polyfill | Copyright (c) 2014 Taylor Hakes - Forbes Lindesay | https://github.com/taylorhakes/promise-polyfill/blob/master/LICENSE*/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){var t=setTimeout;function r(){}function o(e){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function n(a,r){for(;3===a._state;)a=a._value;0!==a._state?(a._handled=!0,o._immediateFn(function(){var e=1===a._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(a._value)}catch(e){return void s(r.promise,e)}i(r.promise,t)}else(1===a._state?i:s)(r.promise,a._value)})):a._deferreds.push(r)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)){var a=e.then;if(e instanceof o)return t._state=3,t._value=e,void g(t);if("function"==typeof a)return void l(function(e,t){return function(){e.apply(t,arguments)}}(a,e),t)}t._state=1,t._value=e,g(t)}catch(e){s(t,e)}}function s(e,t){e._state=2,e._value=t,g(e)}function g(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,a=e._deferreds.length;t<a;t++)n(e,e._deferreds[t]);e._deferreds=null}function c(e,t,a){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=a}function l(e,t){var a=!1;try{e(function(e){a||(a=!0,i(t,e))},function(e){a||(a=!0,s(t,e))})}catch(e){if(a)return;a=!0,s(t,e)}}o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var a=new this.constructor(r);return n(this,new c(e,t,a)),a},o.all=function(e){var s=Array.prototype.slice.call(e);return new o(function(r,n){if(0===s.length)return r([]);var o=s.length;function i(t,e){try{if(e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){i(t,e)},n)}s[t]=e,0==--o&&r(s)}catch(e){n(e)}}for(var e=0;e<s.length;e++)i(e,s[e])})},o.resolve=function(t){return t&&"object"===(void 0===t?"undefined":_typeof(t))&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(a){return new o(function(e,t){t(a)})},o.race=function(n){return new o(function(e,t){for(var a=0,r=n.length;a<r;a++)n[a].then(e,t)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=o:e.Promise||(e.Promise=o)}(window),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(a[o]=n[o])}return a},writable:!0,configurable:!0}),window.taggstar||(window.taggstar={lib:{}}),function(s){function u(e){var t,a=taggstar.config,r=taggstar.util,n=["_taggstar_ses","_taggstar_vid"],o=e.message||"TAGGSTAR: Error!!",i=function(){try{var e,t=s.navigator&&s.navigator.userAgent,a=t.match(/(opera|chrome|safari|firefox|msie|trident|edge(?=\/))\/?\s*(\d+)(\.\d+)+/i)||[];if(/trident/i.test(a[1]))return{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""};if("Chrome"===a[1]){if(null!=(e=t.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:e[1]};if(null!=(e=t.match(/\bEdge\/(\d+(.\d+)+)/i)))return{name:"Microsoft Edge",version:e[1]}}return a=a[2]?[a[1],a[0].substring(a[0].indexOf("/")+1)]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&a.splice(1,1,e[1]),{name:a[0],version:a[1]}}catch(e){return{name:"unknown",version:"1"}}}()||{};a&&!a.experienceRequired&&n.push("_taggstar_exp"),this.name=e.name||"TaggstarError",this.siteKey=e.siteKey||a&&a.key||taggstar.tm&&taggstar.tm.key,this.code=e.code||"ERR01",this.message=o,this.host=r&&r.getRootDomain()||s.location&&s.location.host,this.href=s.location&&s.location.href,this.timestamp=Date.now(),this.severity=e.severity||50,this.environment=a&&a.environment||taggstar.params&&taggstar.params.taggEnv||"prod",this.browser=i.name,this.browserVersion=i.version,this.locale=s.navigator&&s.navigator.language,this.cookies=function(e){var t=taggstar.util;return t&&"function"==typeof t.getCookie?e.map(function(e){return{name:e,value:t.getCookie(e)}}):null}(n),this.module=a?a.module:null,this.minSeverity=a?a.errorMinSeverity:0,this.sendingProbability=a?a.errorSendingProbability:1,e.stack?this.stack=e.stack:((t=new Error(o)).name=this.name,t.stack?this.stack=t.stack:this.stack=o)}(u.prototype=Object.create(Error.prototype)).constructor=u,taggstar.exception={Error:u,handle:function t(e,a){var r,n,o,i,s,g,c=!1,l=taggstar.util;a=a||0;try{if(!(e instanceof u)&&a<2)throw a+=1,new u({name:e.name,message:e.message,stack:e.stack||e.message});if(taggstar.log(e,"error"),"dev"===e.environment)return;try{l&&l.jsonCall&&e instanceof u&&(o=taggstar.config,s=e.sendingProbability,g=e.minSeverity,n=o&&o.api&&o.api.log,e.severity<g?c=!0:s<=0?c=!0:s<1&&(c=s<(i=Math.random())),taggstar.log(l.renderTemplate("silent mode calculation values are min severity: {errorMinSeverity} - probability: {errorSendingProbability} - random: {random} - silentMode:  {silentMode}}",{errorMinSeverity:g,errorSendingProbability:s,random:i||"NaN",silentMode:c}),"info"),!c&&n&&(r=o.urls.logRoot+n.endpoint)&&l.jsonCall(n.verb,r,JSON.stringify(e)).then(function(e){taggstar.log("log sent successfully","info")}).catch(function(e){taggstar.log(e,"error")}))}catch(e){taggstar.log(e,"error")}}catch(e){t(e,a)}}}}(window),taggstar.initConfig=function(t,r,e){r=r||"prod";function a(e,t){var a=c[r][t];return g.renderTemplate(e,{alias:a.alias,topLevel:a.topLevel,protocol:a.protocol})}function n(e){return g.renderTemplate(e,{key:t})}var o,i,s=taggstar.exception.Error,g=taggstar.util,c={prod:{api:{topLevel:"com",alias:"api",protocol:""},log:{topLevel:"com",alias:"log",protocol:""}},qa:{api:{topLevel:"com",alias:"api.qa",protocol:""},log:{topLevel:"net:8200",alias:"qa",protocol:"http:"}},dev:{api:{topLevel:"net:8080",alias:"api.dev",protocol:"http:"},log:{topLevel:"net:8080",alias:"log.dev",protocol:"http:"}}};if(!t)throw new s({message:"sitekey should be defined",code:"CONFIG01",severity:99});if(!c[r])throw new s({message:"invalid environment value: "+r,code:"CONFIG02",severity:99,siteKey:t});return o=a("{protocol}//{alias}.taggstar.{topLevel}","api"),i=a("{protocol}//{alias}.taggstar.{topLevel}","log"),{version:"",cookieVersion:"3",idGenerator:taggstar.lib.uuid.generate,key:t,environment:r,urls:{configRoot:o,apiRoot:o,logRoot:i},currencyCode:"GBP",defaultLocale:"en-GB",locale:"",experienceRequired:!1,experimentId:null,experienceId:"default",sitePrefix:"/",deviceType:"",interval:500,tries:50,jquery:"",handlebars:"",ui:"",module:"",isCustomerLite:!1,modules:{},errorMinSeverity:0,errorSendingProbability:1,api:{category:{endpoint:n("/api/v2/key/{key}/category/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},product:{endpoint:n("/api/v2/key/{key}/product/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},productUpdate:{endpoint:n("/api/v2/key/{key}/product/update"),verb:"POST",mandatoryFields:{},optionalFields:{}},conversion:{endpoint:n("/api/v2/key/{key}/conversion/order"),verb:"POST",mandatoryFields:{},optionalFields:{}},basket:{endpoint:n("/api/v2/key/{key}/basket/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},event:{endpoint:n("/api/v2/key/{key}/event"),verb:"POST"},eventQuery:{endpoint:n("/api/v2/key/{key}/event/query"),verb:"POST"},configuration:{endpoint:n("/api/v2/key/{key}/config{query}"),verb:"GET",mock:e},log:{endpoint:"/api/v1/logs",verb:"POST"}}}},function(){var d=taggstar.exception.Error;taggstar.util={windowWrapper:{getLocation:function(){return window.location},isCookie:function(){return window.navigator.cookieEnabled},setCookie:function(e){document.cookie=e},getCookie:function(){return document.cookie},createElement:function(e){return document.createElement(e)},appendChild:function(e,t){e.appendChild(t)},getElementsByTagName:function(e){return document.getElementsByTagName(e)},getElementById:function(e){return document.getElementById(e)},getXMLHttpRequest:function(){return new XMLHttpRequest},isLocalStorage:function(){var e="_taggstar_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}},getLocalStorage:function(e){return window.localStorage.getItem(e)},setLocalStorage:function(e,t){window.localStorage.setItem(e,t)},removeLocalStorage:function(e){return window.localStorage.removeItem(e)}},loadTag:function(s,g,c,l,u){return new Promise(function(e,a){g=g||"script",c=c||"head";var t,r,n=taggstar.util,o=n.windowWrapper,i="src";if(s){switch(t=o.createElement(g),g){case"script":t.async=!0;break;case"link":t.type="text/css",t.rel="stylesheet",i="href"}if(r=o.getElementsByTagName(c),t[i]=s,l&&(t.id=l),u&&(t.integrity=u,t.crossOrigin="anonymous"),t.onload=function(){e({tag:g,url:s,id:l,sri_hash:u})},t.onerror=function(e){var t="string"==typeof e?n.renderTemplate("{error} while requesting url: {url}",{error:e,url:s}):e&&e.message?e.message:n.renderTemplate("error while requesting url: {url}",{url:s});a(new d({message:t,code:"UTIL11",severity:99}))},0<r.length)if(l){if(null!==o.getElementById(l))return void a(new d({message:n.renderTemplate("trying to add an existing tag: <{url}>",{url:s}),code:"UTIL14",severity:99}));o.appendChild(r[0],t)}else o.appendChild(r[0],t);else a(new d({message:n.renderTemplate("no <{parent}> tag found to append url: {url}",{parent:c,url:s}),code:"UTIL12",severity:99}))}else a(new d({message:n.renderTemplate("url not provided for <{tag}> tag injection inside <{parent}> element",{tag:g,parent:c}),code:"UTIL01",severity:99}))})},jsonCall:function(e,i,t){return new Promise(function(a,r){var n=taggstar.util,o=n.windowWrapper.getXMLHttpRequest();if(o){t=t||null,o.open(e,i,!0);try{"responseType"in o&&(o.responseType="json")}catch(e){}o.onload=function(){var e=o.status,t="json"===o.responseType?o.response:JSON.parse(o.responseText);200<=e&&e<300?a(t):r(new d({message:n.renderTemplate("{errorDetail} for url: {url}",{status:e,url:i,errorDetail:t&&t.result&&t.result.errorMessage?t.result.errorMessage:"error"}),code:"UTIL09",severity:81}))},o.onerror=function(){r(new d({message:n.renderTemplate("connection failure for url: {url}",{url:i}),code:"UTIL10",severity:81}))},o.send(t)}else r(new d({message:"failed to create XMLHttpRequest object",code:"UTIL13",severity:81}))})},renderTemplate:function(e,t){var a,r;for(a in t)r=t[a],e=e.replace(new RegExp("{"+a+"}","g"),r);return e},isCookie:function(){return taggstar.util.windowWrapper.isCookie()},setCookie:function(e,t,a){var r,n,o=taggstar&&taggstar.config&&taggstar.config.sitePrefix;if(!e)throw new d({message:"name not defined",code:"UTIL03",severity:81});if(!o)throw new d({message:"sitePrefix not defined",code:"UTIL04",severity:81});n=a?((r=new Date).setTime(r.getTime()+60*a*1e3),"; expires="+r.toUTCString()):"",taggstar.util.windowWrapper.setCookie(e+"="+t+n+"; path="+o+";domain="+taggstar.util.getRootDomain())},getCookie:function(e){var t,a,r=e+"=",n=(taggstar.util.windowWrapper.getCookie()||"").split(";");for(t=0;t<n.length;t++){for(a=n[t];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(r))return a.substring(r.length,a.length)}return null},deleteCookie:function(e){taggstar.util.setCookie(e,"",-1)},saveLocalStorage:function(e,t,a){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var r=60*(a||30)*1e3,n={value:JSON.stringify(t),timestamp:(new Date).getTime()+r},o="_"+taggstar.config.key;return taggstar.util.windowWrapper.setLocalStorage(e+o,JSON.stringify(n)),t},loadLocalStorage:function(e){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var t,a="_"+taggstar.config.key;return!!(t=JSON.parse(taggstar.util.windowWrapper.getLocalStorage(e+a)))&&((new Date).getTime()<t.timestamp&&JSON.parse(t.value))},removeLocalStorage:function(e){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var t="_"+taggstar.config.key;return taggstar.util.windowWrapper.removeLocalStorage(e+t),!0},setPageData:function(e,t,a){a=a||taggstar.config.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[a]=taggstar.pageData[a]||{},taggstar.pageData[a][e]=t},getPageData:function(e,t){return t=t||taggstar.config.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[t]=taggstar.pageData[t]||{},taggstar.pageData[t][e]},deletePageData:function(e,t){t=t||taggstar.config.module||"general",taggstar.pageData&&taggstar.pageData[t]&&taggstar.pageData[t][e]&&delete taggstar.pageData[t][e]},encodeCookieString:function(e){var t,a,r="v:"+e.cookieVersion,n={id:"experimentId",group:"experimentGroup",visitor:"id"};for(a in"3"===e.cookieVersion&&delete n.visitor,n)t=void 0===e[n[a]]?"":e[n[a]],r+=(void 0||"|")+a+(void 0||":")+t;return r},decodeCookieString:function(e,t){if(!e)return null;var a,r,n,o,i,s,g={cookieVersion:e.substr(2,1)};if(s=parseInt(g.cookieVersion,10),isNaN(s)||3<s)return taggstar.util.deleteCookie("_taggstar_exp"),null;try{for(a=e.split("|"),r=1;r<a.length;r++)switch(o=(n=a[r].split(":"))[0],i="null"==n[1]||"undefined"==n[1]?"":n[1],g.cookieVersion){case"1":switch(o){case"visitor":g.id=i;break;case"basket":case"category":case"product":g.experimentGroup=i;break;default:g.experimentId=i}break;case"2":switch(o){case"visitor":g.id=i;break;case"group":g.experimentGroup=i;break;case"id":g.experimentId=i}break;case"3":switch(o){case"group":g.experimentGroup=i;break;case"id":g.experimentId=i}}t||(g.modules={product:g.experimentGroup,category:g.experimentGroup,basket:g.experimentGroup})}catch(e){taggstar.exception.handle(e),taggstar.util.deleteCookie("_taggstar_exp"),g=null}return g},getRootDomain:function(){var e,t=taggstar.util.windowWrapper.getLocation().host.toLowerCase(),a=t;return null!=t&&1<(e=t.split(".").reverse()).length&&(a=2<e.length&&("co"===e[1]||"com"===e[1])?e[2]+"."+e[1]+"."+e[0]:e[1]+"."+e[0]),a},cleanDuplicateProducts:function(e){var t,a,r,n,o,i,s,g,c,l={},u=[];if(!e)return[];for(t=0;t<e.length;t++){if(o=(a=e[t]).id,i=parseFloat(a.unitPrice),s=parseFloat(a.quantity),g=a.category,isNaN(i)||isNaN(s))throw new d({message:"invalid product unit price/quantity value",code:"UTIL07",severity:71});if(!o)throw new d({message:"invalid product id",code:"UTIL08",severity:71});if(a.variant)for(c in a.variant)a.variant.hasOwnProperty(c)&&(o+="_"+a.variant[c]);l[o]?l[o].quantity+=s:(l[o]={quantity:s,unitPrice:i,id:a.id},a.category&&(l[o].category=g),a.variant&&(l[o].variant=a.variant),a.stock&&(l[o].stock=a.stock))}for(r in l)l.hasOwnProperty(r)&&(n={id:(a=l[r]).id,quantity:a.quantity,unitPrice:a.unitPrice},a.category&&(n.category=a.category),a.variant&&(n.variant=a.variant),a.stock&&(n.stock=a.stock),u.push(n));return u},getBalloonClass:function(e,t,a){var r,n="balloon";if(!e||!e.code||!e.category)throw new d({message:"invalid message parameter",code:"UTIL06",severity:91});return r="QPH"===e.code,"boolean"==typeof t?r=t:"string"==typeof t&&(n=t),"tagg-reset tagg-"+n+" tagg-"+e.category.toLowerCase()+" tagg-"+e.code+(r?" tagg-hot":"")+(a?" "+a:"")},getBalloon:function(e,t,a,r){if(e){a=taggstar.$.extend({decor:!0,closeButton:!1},a);var n,o='<div class="'+taggstar.util.getBalloonClass(e,t,a.extraBalloonClass)+'"><div class="tagg-reset tagg-icon"></div><div class="tagg-reset tagg-txt">'+(e.text?e.text:e.message)+"</div>";return o+=a.decor?'<div class="tagg-reset tagg-decor"></div>':"",o+=a.closeButton?'<div class="tagg-reset tagg-x"></div></div>':"",n=taggstar.$(o),a.iconCss&&n.find(".tagg-icon").css(a.iconCss),a.txtCss&&n.find(".tagg-txt").css(a.txtCss),a.closeCss&&n.find(".tagg-x").css(a.closeCss),void 0!==r&&n.data("tagg-index",r),n}},getBalloonParams:function(e,t){var a=taggstar.$.extend(taggstar._defaultMessageParams,e);return a.wrapperClass+=a.isMobile?"-n":"",a.experienceWrapperClass=taggstar.config.experienceRequired?"tagg-"+taggstar.config.experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",a.callback||"function"!=typeof t||(a.callback=t),a},getBalloonContainer:function(e){var t="tagg-reset "+e.wrapperClass+(e.extraClass?" "+e.extraClass:"")+(e.experienceWrapperClass?" "+e.experienceWrapperClass:"");return e.wrapperStyle?taggstar.$('<div class="'+t+'"></div>').css(e.wrapperStyle):taggstar.$('<div class="'+t+'"></div>')},getQueryParams:function(){var e,t,a,r=taggstar.util.windowWrapper.getLocation().search.substring(1),n={};if(!r)return n;for(e=r.split("&"),t=0;t<e.length;t++)0===(a=e[t].split("="))[0].indexOf("tagg")&&(n[a[0]]=!(1<a.length)||a[1]);return n},createTaggstarQueryString:function(){var e,t="?";for(e in taggstar.params)taggstar.params.hasOwnProperty(e)&&(t+=e+"="+taggstar.params[e]+"&");return t.slice(0,t.length-1)},validateDimensions:function(e){var t,a,r,n={};if(!e)return n;for(t=1;t<4;t++)(r=e[a="dim"+t])&&"string"==typeof r&&(n[a]=r.substring(0,32));return n},debugDialog:function(e,t,a){if(taggstar.debug){"object"===(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify(t));var r=taggstar.$('<div id="dialog"></div>');r.append("<h1>"+e+"</h1>"),r.append("<p>"+t+"</p>"),taggstar.$("body").append(r),r.css({position:"fixed",left:"35%",top:"20%",width:"50%",padding:"10px",height:"auto",background:a||"green",color:"white",fontSize:"11px",textAlign:"center",zIndex:1e4})}},getObjectByPath:function(e,t){for(var a=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),r=0,n=a.length;r<n;++r){var o=a[r];if(!(o in e))return null;e=e[o]}return e}}}(),function(){var e;if(!e){var a=new Array(16);e=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}for(var t=Array,n=[],o={},r=0;r<256;r++)n[r]=(r+256).toString(16).substr(1),o[n[r]]=r;function p(e,t){var a=t||0,r=n;return r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]}var i=e(),f=[1|i[0],i[1],i[2],i[3],i[4],i[5]],m=16383&(i[6]<<8|i[7]),v=0,y=0;var s={v1:function(e,t,a){var r=t&&a||0,n=t||[],o=null!=(e=e||{}).clockseq?e.clockseq:m,i=null!=e.msecs?e.msecs:(new Date).getTime(),s=null!=e.nsecs?e.nsecs:y+1,g=i-v+(s-y)/1e4;if(g<0&&null==e.clockseq&&(o=o+1&16383),(g<0||v<i)&&null==e.nsecs&&(s=0),1e4<=s)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=i,m=o;var c=(1e4*(268435455&(i+=122192928e5))+(y=s))%4294967296;n[r++]=c>>>24&255,n[r++]=c>>>16&255,n[r++]=c>>>8&255,n[r++]=255&c;var l=i/4294967296*1e4&268435455;n[r++]=l>>>8&255,n[r++]=255&l,n[r++]=l>>>24&15|16,n[r++]=l>>>16&255,n[r++]=o>>>8|128,n[r++]=255&o;for(var u=e.node||f,d=0;d<6;d++)n[r+d]=u[d];return t||p(n)},parse:function(e,t,a){var r=t&&a||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(t[r+n++]=o[e])});n<16;)t[r+n++]=0;return t}};s.unparse=p,s.BufferClass=t,taggstar.lib.uuid={generate:function(){var e=+new Date,t=e-taggstar.initTimestamp;return s.v1({msecs:e,nsecs:t%1e4})}}}(),function(){var R=taggstar.exception.Error,D=taggstar.util,r="_taggstar_ses",n="_taggstar_exp",o="_taggstar_vid",s="_taggstar_click",u="_taggstar_cfg",P="tagg_module",T="tagg_style",I="tagg_jquery",O="tagg_handlebars",E="tagg_ui",y="|TAGGSTAR|";taggstar.loaded=!1,taggstar.version="3.9.1",taggstar.constant={null:"_taggstar_null"},taggstar.log=function(e,t){(taggstar.debug||!taggstar.configured&&(taggstar.params&&taggstar.params.taggDebug||D&&D.getQueryParams().taggDebug))&&(t=t||"log",console[t]("TAGGSTAR: ",e))},taggstar.setup=function(){return new Promise(function(h,w){function e(e){function t(e){var t=parseInt(e,10);return!isNaN(t)&&t}var a,r,n,o,i,s,g,c,l,u,d,p,f,m=taggstar.config,v=taggstar.tm&&taggstar.tm.style,y=[];if(e)if(o=e.config&&e.config.config,i=e.config&&e.config.libs,s=e.config&&e.config.fileSet,g=e.config&&e.config.lite,"true"!==e.experienceRequired&&!0!==e.experienceRequired||(m.experienceRequired=!0),s){if(a=s.default.css,r=s.default.js,Array.isArray(s.experiments)&&taggstar.params.taggExperimentId&&!e.experienceRequired)for(n=0;n<s.experiments.length;n++)if((s.experiments[n]&&s.experiments[n].id)==taggstar.params.taggExperimentId){a=s.experiments[n].fileSet.css,r=s.experiments[n].fileSet.js;break}if(m.version=e.version||m.version,o&&(!1!==(c=t(o.maxDataLayerTries))&&-1<c&&(m.tries=c),!1!==(l=t(o.dataLayerRetryIntervalMs))&&-1<l&&(m.interval=l),!1!==(u=t(o.errorMinSeverity))&&(m.errorMinSeverity=u),p=o.errorSendingProbability,f=parseFloat(p),!1!==(d=!isNaN(f)&&f)&&0<=d&&(m.errorSendingProbability=d)),m.currencyCode=o&&o.defaultCurrencyCode||m.currencyCode,m.defaultLocale=e.defaultLocale||m.defaultLocale,m.jquery=i&&i.jquery||m.jquery,m.handlebars=i&&i.handlebars||m.handlebars,m.ui=i&&i.ui||m.ui,m.sitePrefix=e.config&&e.config.sitePrefix||m.sitePrefix,m.urls.apiRoot=e.apiHostname||m.urls.apiRoot,m.isCustomerLite="true"===g.enabled||!0===g.enabled,m.isCustomerLite){if(!(g.modules&&0<g.modules.length))return taggstar.log("no modules found for lite customer","info"),void h(!0);g.modules.forEach(function(e){m.modules[e]=g[e]})}v&&y.push(D.loadTag(a,"link","head",T,k)),m.jquery&&y.push(D.loadTag(m.jquery,"script","head",I,C)),m.handlebars&&y.push(D.loadTag(m.handlebars,"script","head",O,x)),m.ui&&y.push(D.loadTag(m.ui,"script","head",E,_)),y.length?Promise.all(y).then(function(e){e.forEach(function(e){taggstar.log(e.url+" "+e.tag+" tag loaded","info"),"script"===e.tag&&e.id===I&&(taggstar.$=jQuery.noConflict(!0)),"script"===e.tag&&e.id===O&&(taggstar.Handlebars=Handlebars.noConflict(!0))}),D.loadTag(r,"script","body",P,b).then(function(e){taggstar.log(e.url+" script tag loaded","info"),delete taggstar.tm,delete taggstar.sri,h(!0)}).catch(w)}).catch(w):D.loadTag(r,"script","body",P,b).then(function(e){taggstar.log(e.url+" script tag loaded","info"),delete taggstar.tm,delete taggstar.sri,h(!0)}).catch(w)}else w(new R({message:"config json data (fileSet) is null/invalid",code:"CORE01",severity:99}));else w(new R({message:"config json data is null/invalid",code:"CORE01",severity:99}))}var t,a,r,n,b=taggstar.sri&&taggstar.sri.js,k=taggstar.sri&&taggstar.sri.css,C=taggstar.sri&&taggstar.sri.jquery,x=taggstar.sri&&taggstar.sri.handlebars,_=taggstar.sri&&taggstar.sri.ui,o=taggstar.tm&&taggstar.tm.key,i=taggstar.tm&&taggstar.tm.configUrl;if(!D.isCookie())return taggstar.log("cookie not supported","info"),void h(!1);taggstar.log("setup started","info"),taggstar.initTimestamp=Date.now(),taggstar.params=Object.assign({},taggstar.params,D.getQueryParams()),taggstar.config=taggstar.initConfig(o,taggstar.params.taggEnv,i),taggstar.log("config object created with default values","info"),taggstar.configured=!0,taggstar.fakeData=taggstar.params.taggFakeData,taggstar.keepUI=taggstar.params.taggKeepUI,delete taggstar.params.taggKeepUI,delete taggstar.params.taggEnv,taggstar.debug="prod"!==taggstar.config.environment||0<Object.keys(taggstar.params).length,taggstar.responseData={},(t=!taggstar.debug&&D.loadLocalStorage(u))?e(t):(a=taggstar.config,r=a.api.configuration,n=a.urls.configRoot+D.renderTemplate(r.endpoint,{query:"?flattened=false"}),r.mock&&(n=r.mock),D.jsonCall(r.verb,n).then(function(e){return taggstar.log("request config from api server","info"),e&&!taggstar.debug&&(taggstar.log("create local storage for config","info"),D.saveLocalStorage(u,e,60)),e}).then(e).catch(w))})},taggstar.boot=function(l,u){return new Promise(function(e,t){var a,r,n=0,o=!1,i=taggstar.config,s=i.tries,g=i.interval,c=i.jquery;"function"==typeof l?(taggstar.booting=!0,taggstar.log("booting..."),r=setInterval(function(){if(taggstar.booting){if(taggstar.$||c||(taggstar.$=window.jQuery),!taggstar.$)return s<=++n?(clearInterval(r),delete taggstar.booting,void t(new R({message:"jQuery couldn't be loaded. jQuery not found",code:"CORE02",severity:99}))):void(n%5==0&&taggstar.log("jQuery not loaded","warn"));if(!a)try{i.module=a=l()}catch(e){return s<=++n?(clearInterval(r),delete taggstar.booting,void t(e instanceof R?e:new R({stack:e.stack,name:e.name,message:e.message,code:"CORE03",severity:99}))):void 0}if(a&&a!==taggstar.constant.null){if(!u||!u[a]||"function"!=typeof u[a].condition)return clearInterval(r),delete taggstar.booting,void t(new R({message:"settings invalid (module name or related condition function exists? )",code:"CORE31",severity:99}));if(!o)try{o=u[a].condition()}catch(e){return s<=++n?(clearInterval(r),delete taggstar.booting,void t(e instanceof R?e:new R({stack:e.stack,name:e.name,message:e.message,code:"CORE28",severity:99}))):void 0}if(o){if(clearInterval(r),delete taggstar.booting,"function"!=typeof u[a].module)return void t(new R({message:"settings invalid (module function exists? )",code:"CORE32",severity:99}));taggstar.log("successful boot");try{u[a].module(),e(!0)}catch(e){return void t(e instanceof R?e:new R({stack:e.stack,name:e.name,message:e.message,code:"CORE33",severity:99}))}}else{if(s<=++n)return clearInterval(r),delete taggstar.booting,void t(new R({message:"condition failed (data layer missing?)",code:"CORE30",severity:99}));n%5==0&&taggstar.log("waiting for condition function","warn")}}else{if(s<=++n)return clearInterval(r),delete taggstar.booting,void(a===taggstar.constant.null?(taggstar.log("null module detected!","warn"),e(!0)):t(new R({message:"booting failed during module detection (data layer missing?)",code:"CORE29",severity:99})));a===taggstar.constant.null&&(a=void 0),n%5==0&&taggstar.log("waiting for module detection function","warn")}}},g)):t(new R({message:"first parameter of taggstar.boot should be type of function",code:"CORE25",severity:99}))})};taggstar.init=function(e){if(!taggstar.configured)throw new R({message:"config object not created yet",code:"CORE34",severity:20});if(e.hasOwnProperty("environment")||e.hasOwnProperty("key"))throw new R({message:"key/environment values cannot be set",code:"CORE27",severity:20});if(e.hasOwnProperty("experienceRequired"))throw new R({message:"experienceRequired value cannot be set",code:"CORE35",severity:20});if(e.hasOwnProperty("experienceId")&&!e.experienceId.trim())throw new R({message:"experienceId value is not valid",code:"CORE36",severity:20});taggstar.$.extend(taggstar.config,e)},taggstar.submitData=function(n,o){return new Promise(function(r,c){var e,l,t,a;taggstar.config?(e=taggstar.config.api[n])?(t=e.verb,l=taggstar.config.urls.apiRoot+e.endpoint,l+=D.createTaggstarQueryString(),taggstar.log("posting data","info"),taggstar.log(o,"info"),a={url:l,data:JSON.stringify(o),dataType:"json",type:t,contentType:!1,success:function(e,t,a){e.result&&e.result.success?r({responseData:e,jqXHR:a}):c(new R({message:e.result.errorMessage,code:"CORE08",severity:51}))},error:function(e,t,a){var r,n,o=e&&e.responseJSON,i=o&&o.result,s=a||"error",g=51;e&&"412"==e.status&&(D.removeLocalStorage(u),taggstar.versionMismatch||(r=taggstar.config.module,n=taggstar.config.key,taggstar.versionMismatch=!0,taggstar.tm={key:n,style:"conversion"!==r},taggstar.$("#"+T).remove(),taggstar.$("#"+P).remove(),taggstar.$("#"+I).remove(),taggstar.$("#"+O).remove(),taggstar.$("#"+E).remove(),D.setPageData("configured",!1,"assistant"),D.setPageData("configured",!1,"recs"),taggstar.configured=!1,taggstar.setup().catch(taggstar.exception.handle)),g=-1),c(new R({message:D.renderTemplate("{errorMessage}: {detailMessage} for url: {url}",{errorMessage:s,url:l,detailMessage:i&&i.errorMessage?i.errorMessage:""}),code:"CORE09",severity:g}))}},taggstar.$.ajax(a)):c(new R({message:"unknown API method: "+n,code:"CORE07",severity:99})):c(new R({message:"config not found",code:"CORE13",severity:99}))})},taggstar.productRequest=function(o,i){return new Promise(function(t,a){var e,r;if(e="update"===(i=i||"visit")?"productUpdate":"product","visit"===i||"update"===i)if(o.id)if(o.name=taggstar._sanitizeName(o.name),(r=taggstar._sanitizePrice(o.price)).error)a(new R({message:r.error,code:"CORE06",severity:49}));else{o.price=r.price,o.category=taggstar._sanitizeCategory(o.category);var n=taggstar._buildRequest({product:o});taggstar.submitData(e,n).then(function(e){taggstar._addResponseToCookie(e.responseData,e.jqXHR),t(e.responseData)}).catch(function(e){a(e)})}else a(new R({message:"no product id",code:"CORE10",severity:51}));else a(new R({message:"invalid action type: "+i,code:"CORE05",severity:99}))})},taggstar.categoryRequest=function(r){return new Promise(function(t,a){var e;!Array.isArray(r.products)||Array.isArray(r.products)&&0===r.products.length?a(new R({message:"product ids for category cannot be empty",code:"CORE26",severity:51})):(r.category=taggstar._sanitizeCategory(r.category),r.products.some(function(e){return!e})?a(new R({message:"no product id for category: "+r.category,code:"CORE14",severity:51})):(e=taggstar._buildRequest(r),taggstar.submitData("category",e).then(function(e){taggstar._addResponseToCookie(e.responseData,e.jqXHR),t(e.responseData)}).catch(function(e){a(e)})))})},taggstar.basketRequest=function(r){return new Promise(function(t,a){var e;r.lineItems=D.cleanDuplicateProducts(r.lineItems),e=taggstar._buildRequest({basket:r}),taggstar.submitData("basket",e).then(function(e){taggstar._addResponseToCookie(e.responseData,e.jqXHR),t(e.responseData)}).catch(function(e){a(e)})})},taggstar.conversionRequest=function(n,o){return new Promise(function(t,a){var e,r;n.id?(r=taggstar._sanitizePrice(n.totalPrice)).error?a(new R({message:r.error,code:"CORE16",severity:49})):(n.orderItems=D.cleanDuplicateProducts(n.orderItems),n.currency=n.currency?n.currency:taggstar.config.currencyCode,e=taggstar._buildRequest({order:n},o),taggstar.submitData("conversion",e).then(function(e){D.debugDialog("Conversion successful!",e.responseData,"green"),t(e.responseData)}).catch(function(e){D.debugDialog("Conversion server error!",e,"red"),a(e)})):a(new R({message:"no order id",code:"CORE15",severity:51}))})},taggstar.eventRequest=function(n){return new Promise(function(t,a){var e,r;D.getPageData("responseData")&&D.getPageData("responseData").eventGroupId&&!n.eventGroupId&&(n.eventGroupId=D.getPageData("responseData").eventGroupId),e=taggstar._buildRequest({event:n}),r="{ "+n.category+" : "+n.name+" }",taggstar.submitData("event",e).then(function(e){taggstar.log("Event "+r+" successfully recorded"),t(e.responseData)}).catch(function(e){a(e)})})},taggstar.eventQueryRequest=function(r){return new Promise(function(t,a){var e=taggstar._buildRequest({query:r});taggstar.submitData("eventQuery",e).then(function(e){taggstar.log("Success"),taggstar.log(e.responseData),t(e.responseData)}).catch(function(e){a(e)})})},taggstar.getVisitor=function(e){var t=taggstar._updateVisitorSession();return{sessionId:t,id:taggstar._updateVisitorId(e||t)}},taggstar.getExperimentGroup=function(){var e=taggstar._getExperimentData(!0);return e&&e.experimentGroup},taggstar.deleteVisitor=function(){D.deleteCookie(n),D.deleteCookie(r),D.deleteCookie(o),taggstar.log("Visitor info deleted")},taggstar.handleProductResponse=function(o){return new Promise(function(e,t){taggstar.log("response received","info"),taggstar.log(o,"info");var a,r=o.socialProof,n=r&&Array.isArray(r)&&r.length?r[0].messages:[];for(a=n.length-1;0<=a;a--)n[a].message||(n.splice(a,1),taggstar.exception.handle(new R({message:"missing message body",code:"CORE19",severity:81})));e(n)})},taggstar.handleRequest=taggstar.handleProductResponse,taggstar.handleResponseMulti=function(g){return new Promise(function(e,t){taggstar.log("response received","info"),taggstar.log(g,"info");var a,r,n,o,i=g.socialProof,s={};if(i&&Array.isArray(i)&&0<i.length)for(a=0;a<i.length;a++)n=(r=i[a]).product&&r.product.id,o=r.product&&r.product.variant&&JSON.stringify(r.product.variant),n?r.messages&&(s[o?n+y+o:n]=r.messages):taggstar.exception.handle(new R({message:"missing product id",code:"CORE20",severity:81}));e(s)})},taggstar._defaultMessageParams={firstDelay:500,delayBetween:2500,fade:750,hold:3500,isMobile:!1,tries:50,testInterval:500,insertFunction:"append",wrapperClass:"tagg-balloons-wrapper",extraClass:"",extraBalloonClass:"",closeButton:!1,decor:!1,balloonDisplayCount:0,animatePre:{opacity:0},animateIn:{opacity:1},animateOut:{opacity:0},customAnimation:!1,iconCss:null,txtCss:null,closeCss:null,wrapperStyle:null,experienceWrapperClass:""},taggstar.displayMessageBalloons=function(p,f,e,m,t){return new Promise(function(n,o){if(Array.isArray(p)&&p.length){var i,s,g=[],c=D.getBalloonParams(e,t),l=0;taggstar.searchingDom=!0,s=setInterval(function(){if(taggstar.searchingDom){var e,t,a=taggstar.$(f);try{t="function"!=typeof m||m()}catch(e){return++l>c.tries?(clearInterval(s),taggstar.searchingDom=!1,void o(e instanceof R?e:new R({stack:e.stack,name:e.name,message:e.message,code:"CORE04",severity:99}))):void 0}if(!t||0===a.length)return++l>c.tries?(clearInterval(s),taggstar.searchingDom=!1,void o(new R({message:"balloon anchor not present in DOM: "+f+"/condition does not met",code:"CORE11",severity:99}))):void taggstar.log("looking for balloon anchor DOM element/running condition","warn");clearInterval(s),delete taggstar.searchingDom,taggstar.log("adding balloons to DOM"),e=D.getBalloonContainer(c);try{a[c.insertFunction](e)}catch(e){return void o(new R({message:"problem applying jQuery method: "+c.insertFunction,code:"CORE12",severity:99}))}i=taggstar.$("."+c.wrapperClass.replace(" ","."));for(var r=0;r<p.length;r++)!function(e){var t=D.getBalloon(p[e],"balloon",c,e);g[e]=setTimeout(function(){c.balloonDisplayCount++,c.customAnimation?c.customAnimation(i,t,c,e,function(e){u(c,t,e)},function(){d(t)}):(t.css(c.animatePre),i.append(t),t.animate(c.animateIn,c.fade,function(){u(c,t)}))},c.firstDelay+e*c.delayBetween)}(r);n(!0)}},c.testInterval)}else n(!1);function u(e,t,a){if(a=a||r,e.closeButton&&t.find(".tagg-x").click(function(){taggstar.log("balloon close button clicked");var e=t.data("tagg-index");clearTimeout(g[e]),a(t)}),0===t.data("tagg-index")&&"function"==typeof e.callback)try{e.callback()}catch(e){taggstar.exception.handle(new R({message:"reporting callback failed with error "+e,code:"CORE22",severity:81}))}taggstar.keepUI||setTimeout(function(){a(t)},e.hold)}function r(e){e.animate(c.animateOut,c.fade,function(){d(e)})}function d(e){e.css({zIndex:"-1",opacity:0,display:"block"}),c.balloonDisplayCount--,0===c.balloonDisplayCount&&(taggstar.log("removing balloon container"),i.remove())}})},taggstar.displayMessageBalloonsMulti=function(p,f,m,e,v){return new Promise(function(e,t){var a,r,n,o,i,s,g,c,l,u,d=D.getBalloonParams(m,v);if("function"==typeof f){for(a in p)for(r=p[a],n=0;n<r.length;n++)if(o=r[n],i=D.getBalloonContainer(d),s=D.getBalloon(o),i.append(s),-1<a.indexOf(y)&&(l=(c=a.split(y))[0],u=c[1]),(g=l?f(l,JSON.parse(u)):f(a))&&g.length){taggstar.log("adding balloons to DOM");try{g[d.insertFunction](i)}catch(e){return void t(new R({message:"problem applying jQuery method: "+d.insertFunction,code:"CORE23",severity:99}))}}else taggstar.log("no anchor returned for product "+(l?l+" and for variant ["+u+"]":a),"warn");e(!0)}else t(new R({message:"findAnchor parameter not a function",code:"CORE24",severity:99}))})},taggstar._saveExperimentData=function(e){var t=D.encodeCookieString(e);D.setCookie(n,t,129600)},taggstar._updateVisitorSession=function(e){var t,a=D.getCookie(r)||e;return a?(D.setCookie(r,a,30),a):(t=taggstar.config.idGenerator(),taggstar.log("created new session cookie "+t),D.setCookie(r,t,30),t)},taggstar._updateVisitorId=function(e){var t,a=D.getCookie(o)||e;return a?(D.setCookie(o,a,129600),a):(t=taggstar.config.idGenerator(),taggstar.log("created new visitor cookie "+t),D.setCookie(o,t,129600),t)},taggstar._getExperimentData=function(e){var t=D.getCookie(n);return t?D.decodeCookieString(t,e):null},taggstar._buildRequest=function(e,t){var a,r,n=taggstar.config,o=taggstar._getExperimentData(!0);for(var i in a={visitor:taggstar.getVisitor(o&&o.id)},e)e.hasOwnProperty(i)&&(a[i]=e[i]);return(!taggstar.debug&&n.version||n.deviceType||n.locale)&&(a.client={},!taggstar.debug&&n.version&&(a.client.expectedSiteConfigVersion=n.version),n.deviceType&&(a.client.deviceType=n.deviceType),n.locale&&(a.client.locale=n.locale)),n.experienceRequired?a.experience={id:n.experienceId}:(o?o.id&&(o.cookieVersion=n.cookieVersion,taggstar._saveExperimentData(o)):(o={cookieVersion:n.cookieVersion},taggstar._saveExperimentData(o)),o.experimentId&&(a.experiment={id:o.experimentId,group:o.experimentGroup},a.experiment.group||delete a.experiment)),t&&(a.dimensions=D.validateDimensions(t)),a.product&&(r=D.getCookie(s))&&(a.event={category:r.split("|")[0],name:(r.split("|")[1]?r.split("|")[1]+"-":"")+"product-click",data:{label:a.product.id,value:1}},D.deleteCookie(s)),a},taggstar._addResponseToCookie=function(e,t){var a;taggstar.config.experienceRequired||taggstar._debugParamUsed()?taggstar.config.experienceRequired&&D.deleteCookie(n):t&&"delete"===t.getResponseHeader("X-Taggstar-Experiment")?taggstar.deleteVisitor():(a=taggstar._getExperimentData(!0),e.experiment&&(e.experiment.id!==a.experimentId&&delete a.modules,a.experimentGroup=e.experiment.group,a.experimentId=e.experiment.id),taggstar._saveExperimentData(a)),e.result&&D.setPageData("responseData",{eventGroupId:e.result.eventGroupId,moduleRunId:e.result.moduleRunId})},taggstar._sanitizeName=function(e){return e&&"string"==typeof e?e=(e=(e=(e=e.trim()).replace(/\s+/g," ")).substring(0,64))||"-":"-"},taggstar._sanitizeCategory=function(e){return e=e&&"string"==typeof e?((e=(e=(e=(e=(e=e.replace(/^\s*/g,"").replace(/\s*$/g,"")).replace(/\s*\/\s*/g,"/")).replace(/\s+/g," ")).replace(/\/$/,"")).substring(0,256))&&"/"!=e[0]&&"-"!==e&&(e="/"+e),e||"-"):"-"},taggstar._sanitizePrice=function(e){var t,a={error:"",price:0},r=0;if("number"==typeof e)return a.price=e,a;if(e)try{if(!(0<=(t=e.search(/\d+/))))return a.error="price field contains no digits",a;if(e=e.substring(t),r=parseFloat(e),!isNaN(r))return a.price=r,a;a.error="price field can't be parsed"}catch(e){a.error=e.message}return a},taggstar._debugParamUsed=function(){return taggstar.params.taggExperimentId||taggstar.params.taggExperimentGroup||taggstar.params.taggExperienceId||taggstar.params.taggFakeData||taggstar.params.taggDeviceType||taggstar.params.taggEnv},taggstar.log("methods loaded","info"),taggstar.loaded=!0,taggstar.setup().catch(taggstar.exception.handle)}();